(()=>{"use strict";var e={100:e=>{var t,a="object"==typeof Reflect?Reflect:null,r=a&&"function"==typeof a.apply?a.apply:function(e,t,a){return Function.prototype.apply.call(e,t,a)};t=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(a,r){function i(a){e.removeListener(t,s),r(a)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),a([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t,a){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var n=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,a,r){var i,s,n,l;if(o(a),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,a.listener?a.listener:a),s=e._events),n=s[t]),void 0===n)n=s[t]=a,++e._eventsCount;else if("function"==typeof n?n=s[t]=r?[a,n]:[n,a]:r?n.unshift(a):n.push(a),(i=c(e))>0&&n.length>i&&!n.warned){n.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=n.length,l=d,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,a){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:a},i=d.bind(r);return i.listener=a,r.wrapFn=i,i}function u(e,t,a){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?a?[i.listener||i]:[i]:a?function(e){for(var t=new Array(e.length),a=0;a<t.length;++a)t[a]=e[a].listener||e[a];return t}(i):m(i,i.length)}function v(e){var t=this._events;if(void 0!==t){var a=t[e];if("function"==typeof a)return 1;if(void 0!==a)return a.length}return 0}function m(e,t){for(var a=new Array(t),r=0;r<t;++r)a[r]=e[r];return a}function g(e,t,a,r){if("function"==typeof e.on)r.once?e.once(t,a):e.on(t,a);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){r.once&&e.removeEventListener(t,i),a(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return n},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");n=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var n;if(t.length>0&&(n=t[0]),n instanceof Error)throw n;var o=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw o.context=n,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var l=c.length,d=m(c,l);for(a=0;a<l;++a)r(d[a],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var a,r,i,s,n;if(o(t),void 0===(r=this._events))return this;if(void 0===(a=r[e]))return this;if(a===t||a.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,a.listener||t));else if("function"!=typeof a){for(i=-1,s=a.length-1;s>=0;s--)if(a[s]===t||a[s].listener===t){n=a[s].listener,i=s;break}if(i<0)return this;0===i?a.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(a,i),1===a.length&&(r[e]=a[0]),void 0!==r.removeListener&&this.emit("removeListener",e,n||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,a,r;if(void 0===(a=this._events))return this;if(void 0===a.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==a[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete a[e]),this;if(0===arguments.length){var i,s=Object.keys(a);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=a[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return u(this,e,!0)},s.prototype.rawListeners=function(e){return u(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},s.prototype.listenerCount=v,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},793:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Adblock=void 0;const a="adblocker.enabled";class r{constructor(e){this.variableStore=e,void 0!==chrome.settingsPrivate&&(chrome.settingsPrivate.getPref(a,(e=>{this.variableStore.setInt("adblocker_enabled",e.value?1:0)})),chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.forEach((e=>{e.key===a&&this.variableStore.setInt("adblocker_enabled",e.value?1:0)}))})))}static registerVariables(e){e.registerIntVariable("adblocker_enabled",0)}}t.Adblock=r,r.VARIABLES={adblocker_enabled:{default:0,description:"Whether the adblocker is enabled"}}},923:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AIToolsEventSource=void 0;const a="ui.ai_tools.enabled";class r{constructor(e){this.fireEvent=e}async listenerUpdate(){chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.forEach((async e=>{var t;e.key===a&&await(t=a,new Promise(((e,a)=>{chrome.settingsPrivate.getPref(t,(r=>{chrome.runtime.lastError?a(chrome.runtime.lastError):r.type!==chrome.settingsPrivate.PrefType.BOOLEAN?a("Wrong "+t+" type"):e(r.value)}))})))&&this.fireEvent({eventName:r.EVENT_SOURCE_NAME})}))}))}async activate(){this.listenerUpdate()}async deactivate(){}}t.AIToolsEventSource=r,r.EVENT_SOURCE_NAME="ai_tools_enabled"},896:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AriaEventSource=void 0;class a{constructor(e){this.variableStore=e}async fireEvent(){await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME},e)))}static registerVariables(e){e.registerIntVariable("aria_access_granted",this.VARIABLES.aria_access_granted.default)}onAriaMessage(e,t,a){"show-richhint"===e.cmd&&"aria-access-granted"===e.type&&(this.fireEvent(),this.variableStore.setInt("aria_access_granted",1),a({status:"OK"}))}async activate(){chrome.runtime.onMessageExternal.addListener(this.onAriaMessage.bind(this))}async deactivate(){chrome.runtime.onMessageExternal.removeListener(this.onAriaMessage)}}t.AriaEventSource=a,a.EVENT_SOURCE_NAME="aria-access",a.VARIABLES={aria_access_granted:{default:0,description:"Whether the aria access was granted"}}},792:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserLaunchedWithTagAssigned=void 0;class a{constructor(e){this.backend=e}static eventNameForTag(e){return`browser-launched-with-tag-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:a.eventNameForTag(this.backend.tagName)})}async activate(){await this.backend.wasRecentlyLaunchedWithTag()&&this.fireEvent()}async deactivate(){}}t.BrowserLaunchedWithTagAssigned=a},314:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.CashbackBadgeShownEventSource=void 0,function(e){e[e.INITIALIZING_WINDOW=0]="INITIALIZING_WINDOW",e[e.COMPUTING_IF_COMMIT_CHECK_NEEDED=1]="COMPUTING_IF_COMMIT_CHECK_NEEDED",e[e.WATING_FOR_TAB_COMMIT=2]="WATING_FOR_TAB_COMMIT",e[e.IDLE=3]="IDLE"}(a||(a={}));class r{constructor(e){this.windowCreatedClosures=[],this._state=a.INITIALIZING_WINDOW,this._state=e?a.IDLE:a.INITIALIZING_WINDOW}get hasWindowData(){return this._state!==a.INITIALIZING_WINDOW}get computingIfCommitCheckNeeded(){return this._state===a.COMPUTING_IF_COMMIT_CHECK_NEEDED}get waitingForTabCommit(){return this._state===a.WATING_FOR_TAB_COMMIT}onWindowCreated(){var e;this._state=a.IDLE;for(const t of null!==(e=this.windowCreatedClosures)&&void 0!==e?e:[])t();this.windowCreatedClosures=[]}onComputingIfCommitCheckNeeded(){this._state=a.COMPUTING_IF_COMMIT_CHECK_NEEDED}waitForTabCommit(e){this._state=a.WATING_FOR_TAB_COMMIT;let t=this.stateClosure;this.stateClosure=e,t&&t()}onIdle(){this._state=a.IDLE}commitTab(){this._state=a.IDLE,this.stateClosure&&this.stateClosure(),this.stateClosure=void 0}addWindowReadyClosure(e){this.windowCreatedClosures.push(e)}setStateClosure(e){this.stateClosure=e}}class i{constructor(e){this.variableStore=e,this.cashbackStatesForWindows=new Map,this.cashbackBadgeStateChangedListener=(e,t)=>this.onCashbackStateChanged(e,t),this.windowCreatedListener=e=>this.onWindowCreated(e),this.windowRemovedListener=e=>this.onWindowRemoved(e),this.tabActivatedListener=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.cashbackPrivate}static registerVariables(e){e.registerStringVariable("page_with_cashback",this.VARIABLES.page_with_cashback.default)}getWindowState(e){let t=this.cashbackStatesForWindows.get(e);return t||(t={supported:!1,state:opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new r(!1)},this.cashbackStatesForWindows.set(e,t),t)}getTabInfo(e){return new Promise((t=>{chrome.tabs.query(e,(e=>{t(e[0])}))}))}getCashbackBadgeState(e){return new Promise((t=>opr.cashbackPrivate.getCashbackBadgeState(e,t)))}async onCashbackStateChanged(e,t){const a=this.getWindowState(e);if(!a.stateManager.hasWindowData)return void a.stateManager.addWindowReadyClosure((()=>this.onCashbackStateChanged(e,t)));if(!a.supported)return;a.stateManager.onComputingIfCommitCheckNeeded();const r=await this.getTabInfo({active:!0,windowId:e});let i=()=>a.stateManager.onIdle();try{if(void 0===r)return void a.stateManager.onIdle();if(a.lastKnownActiveTabId!==r.id)return void(i=()=>a.stateManager.waitForTabCommit((()=>this.onCashbackStateChanged(e,t))));a.state===opr.cashbackPrivate.BadgeState.DISABLED&&t!==opr.cashbackPrivate.BadgeState.DISABLED&&await this.fireEvent(r.url),a.state=t}finally{i()}}onWindowCreated(e){const t=this.getWindowState(e.id);t.supported="normal"===e.type&&!e.incognito,t.stateManager.onWindowCreated()}onWindowRemoved(e){this.cashbackStatesForWindows.delete(e)}async onTabActivated(e){const t=this.getWindowState(e.windowId);if(t.stateManager.hasWindowData){if(t.supported)if(t.stateManager.computingIfCommitCheckNeeded)t.stateManager.setStateClosure((()=>this.onTabActivated(e)));else try{if(t.stateManager.waitingForTabCommit)return;const a=await this.getCashbackBadgeState(e.windowId);if(t.state=a,a===opr.cashbackPrivate.BadgeState.DISABLED)return;const r=await new Promise((t=>chrome.tabs.get(e.tabId,t)));await this.fireEvent(r.url)}finally{t.lastKnownActiveTabId=e.tabId,t.stateManager.commitTab()}}else t.stateManager.addWindowReadyClosure((()=>this.onTabActivated(e)))}async fireEvent(e){await this.variableStore.setString("page_with_cashback",e),await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:i.EVENT_SOURCE_NAME},e)))}async activate(){const e=await new Promise((e=>chrome.windows.getAll(e)));chrome.tabs.onActivated.addListener(this.tabActivatedListener),this.cashbackStatesForWindows=new Map(await Promise.all(e.map((e=>new Promise((async t=>{const a="normal"===e.type&&!e.incognito;t([e.id,{supported:a,state:a?await new Promise((t=>{opr.cashbackPrivate.getCashbackBadgeState(e.id,t)})):opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new r(!0)}])})))))),chrome.windows.onCreated.addListener(this.windowCreatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.addListener(this.cashbackBadgeStateChangedListener)}async deactivate(){chrome.tabs.onActivated.removeListener(this.tabActivatedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.removeListener(this.cashbackBadgeStateChangedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener),chrome.windows.onCreated.removeListener(this.windowCreatedListener)}}t.CashbackBadgeShownEventSource=i,i.EVENT_SOURCE_NAME="cashback-badge-shown",i.VARIABLES={page_with_cashback:{default:"none",description:"Page that generated the cashback-badge-shown event"}}},497:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.CategoryEventSource=void 0,function(e){e.WORK="work",e.ENTERTAINMENT="entertainment",e.GAMING="gaming",e.TRAVEL="travel",e.SPORT="sport",e.SHOPPING="shopping",e.OTHER="other"}(a||(a={}));const r={work:["google.com","microsoft.com","live.com","outlook.com"],entertainment:["apple.com/apple-music/","archiveofourown.org","biletyna.pl","bonito.pl","cda.pl","discogs.com","disneyplus.com","ebilet.pl","empik.com","eska.pl","eventbrite.de","eventim.de","eventim.pl","filmweb.pl","genius.com","hbomax.com","hulu.com","imdb.com","kupbilecik.pl","legimi.pl","lubimyczytac.pl","nbc.com","ndr.de","netflix.com","overdrive.com","primevideo.com","publio.pl","radiozet.pl","rmffm.pl","soundcloud.com","spotify.com","tekstowo.pl","thomann.de","ticketmaster.de","ticketmaster.pl","viagogo.de","wattpad.com","woblink.com","worldstar.com","youtube.com","zdf.de"],gaming:["browsergames.de","buffed.de","computerbild.de/spiele/news","cybersport.pl","dekudeals.com","eneba.com","esportnow.pl","g2a.com/pl","gameduell.de/gd","gameforge.com/de-de","gamestar.de/news","gamingsociety.pl","gg.deals","giga.de/games/news","gry-online.pl","ign.com","inside-digital.de/entertainment/news/gaming-news","kinguin.net","lowcygier.pl","metacritic.com/game","miastogier.pl","pl.egamersworld.com","planetagracza.pl","prosiebengames.de","psdeals.net","theverge.com/games","xbdeals.net"],travel:["aa.com","aerotelegraph.de","airbnb.com","airbnb.de","airbnb.pl","avis.com","billiger-mietwagen.de","blablacar.de","blablacar.pl","booking.com","budget.com","carfree.pl","delta.com","discovercars.com","e-podroznik.pl","enterprise.com","europcar.de","eurowings.com","expedia.com","fewo-direkt.de","fly4free.pl","getyourguide.com","hamburg.de","hertz.com","holidaycheck.de","hometogo.de","intercity.pl","itaka.pl","jetblue.com","kayak.com","lot.com","lufthansa.com","marriott.com","noclegi.pl","profitroom.com","rentalcars.com","rentalcars.de","rozklad-pkp.pl","ryanair.com","sixt.de","skyscanner.de","skyscanner.pl","southwest.com","travelbook.de","travelerdreams.com","tripadvisor.com","tripadvisor.de","trivago.de","trivago.pl","tui.com","united.com","universalorlando.com","viator.com","vrbo.com","wakacje.pl","wizzair.com"],sport:["247sports.com","bet365.de","betfan.pl/zaklady-bukmacherskie","betonline.ag","betus.com.pa","cbssports.com","dazn.com","efortuna.pl","espn.com","eurosport.de","eurosport.tvn24.pl","flashscore.com","flashscore.de","flashscore.pl","kicktipp.de","lephaush.net","livescore.com","lvbet.pl/pl","mybookie.ag","nbcsports.com","sofascore.com","sport.bild.de","sport.interia.pl","sport.pl","sport.tvp.pl","sport1.de","sports.tipico.de","sports.yahoo.com","sportschau.de","sts.pl","superbet.pl/intro","tipico.de","topnewsfeeds.net"],shopping:["adcell.com","alerabat.com","allegro.pl","allegrolokalnie.pl","amazon.com","amazon.pl","bizrate.com","ceneo.pl","coolblue.de","ebay-kleinanzeigen.de","ebay.com","empik.com","geizhals.de","groupon.com","groupon.de","groupon.pl","hereswhatstrending.com","idealo.de","ikea.com/pl/pl","kaufda.de","letyshops.com","markt.de","michaels.com","mydealz.de","offerup.com","okazje.info.pl","okazjum.pl","olx.pl","otomoto.pl","pepper.pl","poshmark.com","prospektangebote.de","prospektmaschine.de","qvc.com","searchiqnet.com","skapiec.pl","slickdeals.net","swagbucks.com","thalia.de","tradechaser.com"]};class i{constructor(e,t,a,r){this.fireEvent=e,this.onTabUpdated=t,this.onTabRemoved=a,this.variableStore=r,this.tabsWithCategory=new Map,this.categoryCounters=new Map}static registerVariables(e){e.registerStringVariable("category",this.VARIABLES.category.default)}findCategory(e){return void 0===e?a.OTHER:r.entertainment.find((t=>e.includes(t)))?a.ENTERTAINMENT:r.work.find((t=>e.includes(t)))?a.WORK:r.gaming.find((t=>e.includes(t)))?a.GAMING:r.travel.find((t=>e.includes(t)))?a.TRAVEL:r.sport.find((t=>e.includes(t)))?a.SPORT:r.shopping.find((t=>e.includes(t)))?a.SHOPPING:a.OTHER}async listenerUpdate(e,t,r){if(void 0===t.status||"loading"!==t.status)return;const s=this.findCategory(r.url),n=this.tabsWithCategory.get(e);if(void 0!==n&&this.categoryCounters.get(n)){const e=this.categoryCounters.get(n);e&&this.categoryCounters.set(n,Math.max(e-1,0))}const o=this.categoryCounters.get(s)?this.categoryCounters.get(s)+1:1;this.categoryCounters.set(s,o),this.tabsWithCategory.set(e,s),o>=i.NUMBER_OF_TABS_TO_TRIGGER_EVENT&&s!==a.OTHER&&(this.categoryCounters.set(s,0),this.variableStore.setString("category",s),this.fireEvent({eventName:i.EVENT_SOURCE_NAME,windowId:r.windowId}))}async listenerRemove(e){const t=this.tabsWithCategory.get(e);if(void 0!==t){const a=this.categoryCounters.get(t);void 0!==a&&a>0&&this.categoryCounters.set(t,a-1),this.tabsWithCategory.delete(e)}}async activate(){this.listenerUpdateObject=this.listenerUpdate.bind(this),this.onTabUpdated.addListener(this.listenerUpdateObject),this.listenerRemoveObject=this.listenerRemove.bind(this),this.onTabRemoved.addListener(this.listenerRemoveObject)}async deactivate(){this.onTabUpdated.removeListener(this.listenerUpdateObject),this.listenerUpdateObject=null,this.onTabRemoved.removeListener(this.listenerRemoveObject),this.listenerRemoveObject=null}}t.CategoryEventSource=i,i.NUMBER_OF_TABS_TO_TRIGGER_EVENT=3,i.VARIABLES={category:{default:"unknown",description:"Current category by number of open tabs (work, entertainment, gaming, travel, sport, shopping)"}},i.EVENT_SOURCE_NAME="category"},618:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CheckoutPageEventSource=void 0;class a{constructor(e){this.variableStore=e,this.tabsWithForms=new Map,this.autofillFormDetectedCallback=(e,t)=>this.onAutofillFormDetected(e,t),this.tabsUpdatedCallback=(e,t,a)=>this.onTabsUpdated(e,t,a),this.tabsActivatedCallback=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.richHintsAgentPrivate.onAutofillFormDetected}static registerVariables(e){e.registerStringVariable("page_with_checkout_form",this.VARIABLES.page_with_checkout_form.default)}async activate(){opr.richHintsAgentPrivate.onAutofillFormDetected.addListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.addListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.addListener(this.tabsUpdatedCallback)}async deactivate(){opr.richHintsAgentPrivate.onAutofillFormDetected.removeListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.removeListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.removeListener(this.tabsUpdatedCallback)}async fireEvent(e,t){await this.variableStore.setString("page_with_checkout_form",t),opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME,windowId:e})}onAutofillFormDetected(e,t){this.isCheckoutFormHeuristics(t)&&chrome.tabs.get(e,(t=>{this.tabsWithForms.set(e,t.url),t.active&&this.fireEvent(t.windowId,t.url)}))}onTabsUpdated(e,t,a){t.url&&this.tabsWithForms.delete(e)}onTabActivated(e){const t=this.tabsWithForms.get(e.tabId);t&&this.fireEvent(e.windowId,t)}isCheckoutFormHeuristics(e){return e.fields.find((e=>e.type===opr.richHintsAgentPrivate.AutofillFieldType.CREDIT_CARD_NUMBER))&&e.fields.map((e=>e.group===opr.richHintsAgentPrivate.AutofillFieldGroup.CREDIT_CARD?1:0)).reduce(((e,t)=>e+t))>=2}}t.CheckoutPageEventSource=a,a.EVENT_SOURCE_NAME="checkout-page",a.VARIABLES={page_with_checkout_form:{default:"none",description:"Page that generated the checkout-page event"}}},862:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClockEventSource=t.AgentClock=void 0;const r=a(100);class i{constructor(e){this.variableStore=e,this.sessionStartTime=-1,this.eventEmitter=new r.EventEmitter}static registerVariables(e){e.registerIntVariable("minutes_since_startup",this.VARIABLES.minutes_since_startup.default)}onMinutePassed(e){this.eventEmitter.on("minute-passed",e)}setOnBeforeMinutePassedBarrier(e){this.onBeforeMinutePassedBarrier=e}removeCallback(e){this.eventEmitter.removeListener("minute-passed",e)}async init(e){const t=await new Promise((e=>chrome.storage.local.get("session_data",(t=>{var a;return e(null!==(a=t.session_data)&&void 0!==a?a:{})}))));this.sessionStartTime=await(async()=>("extension_update"===e&&"number"==typeof t.sessionStartTime||(t.sessionStartTime=Date.now(),await new Promise((e=>chrome.storage.local.set({session_data:t},e)))),t.sessionStartTime))(),window.setInterval((()=>this.minutePassedHandler()),6e4),this.minutePassedHandler()}async minutePassedHandler(){const e=Math.round((Date.now()-this.sessionStartTime)/6e4);this.variableStore.setInt("minutes_since_startup",e),this.onBeforeMinutePassedBarrier&&await this.onBeforeMinutePassedBarrier(),this.eventEmitter.emit("minute-passed")}}t.AgentClock=i,i.VARIABLES={minutes_since_startup:{default:0,description:"Time since Opera launched"}};class s{constructor(e){this.clock=e,this.minutePassedCallback=()=>this.onMinutePassed()}async activate(){this.clock.onMinutePassed(this.minutePassedCallback)}async deactivate(){this.clock.removeCallback(this.minutePassedCallback)}onMinutePassed(){opr.richHintsAgentPrivate.fireEvent({eventName:s.EVENT_SOURCE_NAME})}}t.ClockEventSource=s,s.EVENT_SOURCE_NAME="minute-passed"},257:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0,t.Constants=class{constructor(e){this.productType=e}static async getProductType(){if(opr.operaBrowserPrivate)switch(await new Promise((e=>opr.operaBrowserPrivate.getProduct(e)))){case"Opera Crypto":return"crypto";case"Opera GX":return"gx";case"Opera":return"opera";default:return}}}},674:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiscordPanelOpenedEventSource=void 0;class a{constructor(e,t){this.fireEvent=e,this.sidebarOnItemExpandedEvent=t}async listener(e){"Discord"===e&&this.fireEvent({eventName:a.EVENT_SOURCE_NAME})}async activate(){this.sidebarOnItemExpandedEvent&&(this.listenerObject=this.listener.bind(this),this.sidebarOnItemExpandedEvent.addListener(this.listenerObject))}async deactivate(){this.sidebarOnItemExpandedEvent&&(this.sidebarOnItemExpandedEvent.removeListener(this.listenerObject),this.listenerObject=null)}}t.DiscordPanelOpenedEventSource=a,a.EVENT_SOURCE_NAME="discord-panel-opened"},114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReporter=void 0,t.ErrorReporter=class{constructor(){opr.richHintsAgentPrivate.reportFeedback&&(window.addEventListener("error",(e=>this.onUncaughtError(e.error))),window.addEventListener("unhandledrejection",(e=>this.onUnhandledRejection(e.reason))))}onUncaughtError(e){this.reportError("string"==typeof e?e:e.message)}onUnhandledRejection(e){this.reportError("string"==typeof e?e:e.message)}reportError(e){e&&opr.richHintsAgentPrivate.reportFeedback(opr.richHintsAgentPrivate.FeedbackType.ERROR,""+e)}}},304:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventRegistry=void 0;const r=a(100);t.EventRegistry=class{constructor(e,t,a){this.onSpecificationUpdated=e,this.provideEvents=t,this.eventSourceFactory=a,this.eventsSources=new Map,this.eventEmitter=new r.EventEmitter,this.onSpecificationUpdated.addListener((()=>{this.registerEvents()}))}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}registerEvents(){this.eventEmitter.emit("start-providing-events"),this.provideEvents(this.eventSourceFactory.getSupportedEvents(),(e=>{let t=Array.from(this.eventsSources.keys()),a=e.filter((e=>-1===t.indexOf(e))),r=t.filter((t=>-1===e.indexOf(t)));a.forEach((e=>{let t=this.eventSourceFactory.createEventSource(e);t?(this.eventsSources.set(e,t),t.activate(this)):console.warn("The event "+t+" is unknown and cannot be handled")})),r.forEach((e=>{this.eventsSources.get(e).deactivate(this),this.eventsSources.delete(e)}))}))}}},267:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceFactoryImpl=void 0,t.EventSourceFactoryImpl=class{constructor(e){this.eventFactories=e}createEventSource(e){let t=this.eventFactories.get(e);return t?t():null}getSupportedEvents(){return Array.from(this.eventFactories.keys())}}},105:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkExtensionLaunchType=void 0,t.checkExtensionLaunchType=async function(){const e=await new Promise((e=>chrome.storage.local.get("launch_type_check",(t=>{var a;return e(null!==(a=t.launch_type_check)&&void 0!==a?a:{})})))),t=chrome.runtime.getManifest().version,a=void 0===e.last_recorded_version?"first_install":e.last_recorded_version===t?"browser_launch":"extension_update";return e.last_recorded_version=t,await new Promise((t=>chrome.storage.local.set({launch_type_check:e},t))),a}},561:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionPromotions=void 0;class a{constructor(e){[{id:a.ALITOOLS_EXTENSION_ID,variableNames:{has:a.HAS_ALITOOLS_VARIABLE_NAME,uninstalled:a.UNINSTALLED_ALITOOLS_VARIABLE_NAME}},{id:a.AMAZON_EXTENSION_ID,variableNames:{has:a.HAS_AMAZON_VARIABLE_NAME,uninstalled:a.UNINSTALLED_AMAZON_VARIABLE_NAME}}].forEach((t=>{chrome.management.get(t.id,(()=>{e.setInt(t.variableNames.has,void 0===chrome.runtime.lastError?1:0)})),chrome.management.onInstalled.addListener((a=>{t.id===a.id&&e.setInt(t.variableNames.has,1)})),chrome.management.onUninstalled.addListener((a=>{t.id===a&&(e.setInt(t.variableNames.has,0),e.setInt(t.variableNames.uninstalled,1))}))}))}static registerVariables(e){e.registerIntVariable(a.UNINSTALLED_ALITOOLS_VARIABLE_NAME,a.VARIABLES.uninstalled_alitools.default),e.registerIntVariable(a.UNINSTALLED_AMAZON_VARIABLE_NAME,a.VARIABLES.uninstalled_amazon.default),e.registerIntVariable(a.HAS_ALITOOLS_VARIABLE_NAME,a.VARIABLES.has_alitools.default),e.registerIntVariable(a.HAS_AMAZON_VARIABLE_NAME,a.VARIABLES.has_amazon.default)}}t.ExtensionPromotions=a,a.VARIABLES={has_alitools:{default:0,description:"Whether Alitools is currently installed"},has_amazon:{default:0,description:"Whether the Amazon assistant is currently installed"},uninstalled_alitools:{default:0,description:"Whether Alitools has ever been uninstalled"},uninstalled_amazon:{default:0,description:"Whether the Amazon assistant has ever been uninstalled"}},a.ALITOOLS_EXTENSION_ID="nkekkheibgkgeepapinkalkongndfajn",a.AMAZON_EXTENSION_ID="mmmbddcnnndpbdflpccgcknaaabgldak",a.HAS_ALITOOLS_VARIABLE_NAME="has_alitools",a.HAS_AMAZON_VARIABLE_NAME="has_amazon",a.UNINSTALLED_ALITOOLS_VARIABLE_NAME="uninstalled_alitools",a.UNINSTALLED_AMAZON_VARIABLE_NAME="uninstalled_amazon"},688:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTag=t.MatcherRegex=void 0;class a{constructor(e){this.regex=new RegExp(e)}isMatch(e){return this.regex.test(e)}}t.MatcherRegex=a;class r{constructor(e,t,a,r,i,s){this.matchers=e,this.negative_matchers=t,this.tag=a,this.search_limit_days=r,this.min_matchers_to_qualify=i,this.active=s}static createFromJson(e){return e.map((e=>new r(e.matchers.map((e=>new a(e))),e.negative_matchers.map((e=>new a(e))),e.tag,e.search_limit_days,e.min_matchers_to_qualify,e.active)))}}t.HistoryTag=r},103:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagAssignedEventSource=void 0;class a{constructor(e){this.backend=e,this.tagAssignedCallback=()=>{this.fireEvent()}}static eventNameForTag(e){return`history-tag-assigned-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:a.eventNameForTag(this.backend.tagName)})}async activate(e){this.backend.watchForTagAssignment(e)&&this.backend.on("tag-assigned-at-random-time",this.tagAssignedCallback)}async deactivate(e){this.backend.stopWatching(e),this.backend.removeListener("tag-assigned-at-random-time",this.tagAssignedCallback)}}t.HistoryTagAssignedEventSource=a},628:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagEventsBackend=void 0;const r=a(100);class i{}class s{constructor(e,t,a,i,s,n,o){this.tagName=e,this.storageKey=t,this.extensionLaunchType=a,this.extensionLaunchTime=i,this.historyTagUpdater=s,this.historyTagStorage=n,this.state=o,this.eventEmitter=new r.EventEmitter,this.tagsChangedEventListener=()=>{this.reportTagAssigned()},this.watching=!1}static async make(e,t,a,r,n,o){const c=await new Promise((t=>chrome.storage.local.get(e,(a=>{var r;return t(null!==(r=a[e])&&void 0!==r?r:new i)}))));return c.tag_assigned_event_reported=!0===c.tag_assigned_event_reported,new s(r,e,a,t,n,o,c)}static getDefaultStorageKey(e){return`history_tag_assigned_event_source_${e}`}async wasRecentlyLaunchedWithTag(){const e=Date.now();return!("browser_launch"!==this.extensionLaunchType||e-this.extensionLaunchTime>s.LAUNCH_DELAY)&&(await this.historyTagUpdater.waitForPendingUpdate(),this.historyTagStorage.hasTag(this.tagName))}watchForTagAssignment(e){return!this.state.tag_assigned_event_reported&&(this.historyTagStorage.on("tags-changed",this.tagsChangedEventListener),this.watching=!0,!0)}stopWatching(e){this.watching&&(this.historyTagStorage.removeListener("tags-changed",this.tagsChangedEventListener),this.watching=!1)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async saveState(){chrome.storage.local.set({[this.storageKey]:this.state})}async setAlreadyReported(){this.state.tag_assigned_event_reported=!0,await this.saveState()}async reportTagAssigned(){!this.state.tag_assigned_event_reported&&this.historyTagStorage.hasTag(this.tagName)&&(await this.setAlreadyReported(),this.eventEmitter.emit("tag-assigned-at-random-time"))}}t.HistoryTagEventsBackend=s,s.LAUNCH_DELAY=2e4},553:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagStorage=void 0;const r=a(100),i=a(688);class s{constructor(e,t){this.tagState=e,this.variableStore=t,this.eventEmitter=new r.EventEmitter}hasTag(e){return!0===this.tagState.get(e)}static tagNameToStorageName(e){return`history_tag_${e}`}stateToStorage(){const e={history_tags:{}};return this.tagState.forEach(((t,a)=>e.history_tags[a]=t)),e}static async readHistoryTagsFromJson(e){const t=await fetch(chrome.runtime.getURL(e)),a=await t.json();return i.HistoryTag.createFromJson(a).filter((e=>e.active))}static registerVariables(e,t){t.forEach((t=>e.registerIntVariable(s.tagNameToStorageName(t.tag),0)))}static async load(e,t){const a=await new Promise((t=>chrome.storage.local.get(e,t))),r=new Map(Object.keys(a).map((e=>[e,!0===a[e]])));return new s(r,t)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async save(e){const t=Array.from(e.keys()).some((t=>this.tagState.get(t)!==e.get(t)))||Array.from(this.tagState.keys()).some((t=>this.tagState.get(t)!==e.get(t)));this.tagState=e;const a=this.stateToStorage();await new Promise((e=>chrome.storage.local.set(a,e)));for(const e of Array.from(this.tagState.entries()))await this.variableStore.setInt(s.tagNameToStorageName(e[0]),e[1]?1:0,"dont_flush");await this.variableStore.save(),t&&this.eventEmitter.emit("tags-changed")}}t.HistoryTagStorage=s},786:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagUpdater=void 0;class a{constructor(e,t,a){this.storage=e,this.tags=t,setInterval((()=>this.updateTags()),a)}init(e){e.on("start-providing-events",(()=>{this.updateTags()}))}async updateTags(){this.updatingAfterSpecChangePromise||(this.updatingAfterSpecChangePromise=(async()=>{await this.storage.save(await this.calculateTagsFromHistory())})(),await this.updatingAfterSpecChangePromise,this.updatingAfterSpecChangePromise=void 0)}async waitForPendingUpdate(){return this.updatingAfterSpecChangePromise?this.updatingAfterSpecChangePromise:Promise.resolve()}async searchHistory(e){return new Promise((t=>chrome.history.search({text:"",startTime:e,maxResults:1e5},t)))}anyResultMatches(e,t,a){return e.some((e=>!(!e.lastVisitTime||e.lastVisitTime<a)&&void 0!==t.find((t=>t.isMatch(e.url)))))}nResultsMatch(e,t,a,r){let i=Array.from(new Set(e.flat().map((e=>{if(e.lastVisitTime&&!(e.lastVisitTime<r))return void 0!==t.find((t=>t.isMatch(e.url)))?e.url:void 0})).filter((e=>e)).map((e=>e))));return t.filter((e=>i.some((t=>e.isMatch(t))))).length>=a}async calculateTagsFromHistory(){const e=Math.max(...this.tags.map((e=>e.search_limit_days))),t=await this.searchHistory(e);return new Map(await Promise.all(this.tags.map((async e=>{const r=Date.now()-e.search_limit_days*a.DAYS_TO_MS;return this.anyResultMatches(t,e.negative_matchers,r)?[e.tag,!1]:[e.tag,this.nResultsMatch(t,e.matchers,e.min_matchers_to_qualify,r)]}))))}}t.HistoryTagUpdater=a,a.DAYS_TO_MS=864e5},853:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ManyTabsEventSource=void 0;class a{constructor(e,t=a.DEFAULT_MIN_NUMBER_OF_TABS,r=a.DEFAULT_EVENT_FIRE_DELAY){this.performanceVariableCollector=e,this.minNumberOfTabs=t,this.timeToFireEvent=r}areManyTabsOpen(){return this.performanceVariableCollector.totalTabNumber>=this.minNumberOfTabs}async fireEventCallback(){this.areManyTabsOpen()&&opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME}),delete this.timeoutId}async onTotalTabNumberChangedListener(){this.areManyTabsOpen()?void 0===this.timeoutId&&(this.timeoutId=setTimeout(this.fireEventCallback.bind(this),this.timeToFireEvent)):void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),delete this.timeoutId)}async activate(){this.listenerObject=()=>this.onTotalTabNumberChangedListener(),this.performanceVariableCollector.addTotalTabNumberChangedListener(this.listenerObject)}async deactivate(){this.performanceVariableCollector.removeTotalTabNumberChangedListener(this.listenerObject),delete this.listenerObject,clearTimeout(this.timeoutId),delete this.timeoutId}}t.ManyTabsEventSource=a,a.EVENT_SOURCE_NAME="many-tabs-grow-2382",a.DEFAULT_MIN_NUMBER_OF_TABS=25,a.DEFAULT_EVENT_FIRE_DELAY=6e5},756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ManyTabsFlowEventSource=void 0;class a{constructor(e,t=a.DEFAULT_MIN_NUMBER_OF_TABS,r=a.DEFAULT_EVENT_FIRE_DELAY){this.performanceVariableCollector=e,this.minNumberOfTabs=t,this.timeToFireEvent=r,chrome.tabs.onActivated.addListener((()=>{void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>{this.fireEventCallback()}),this.timeToFireEvent))}))}areManyTabsOpen(){return this.performanceVariableCollector.currentWindowTabNumber>this.minNumberOfTabs}async fireEventCallback(){this.areManyTabsOpen()&&opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME}),delete this.timeoutId}async onCurrentWindowTabNumberChangedListener(){this.areManyTabsOpen()?void 0===this.timeoutId&&(this.timeoutId=setTimeout((()=>{this.fireEventCallback()}),this.timeToFireEvent)):void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),delete this.timeoutId)}async activate(){this.listenerObject=()=>this.onCurrentWindowTabNumberChangedListener(),this.performanceVariableCollector.addCurrentWindowTabNumberChangedListener(this.listenerObject)}async deactivate(){this.performanceVariableCollector.removeCurrentWindowTabNumberChangedListener(this.listenerObject),delete this.listenerObject,clearTimeout(this.timeoutId),delete this.timeoutId}}t.ManyTabsFlowEventSource=a,a.EVENT_SOURCE_NAME="many-tabs-flow-grow-2432",a.DEFAULT_MIN_NUMBER_OF_TABS=15,a.DEFAULT_EVENT_FIRE_DELAY=6e5},463:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceVariableCollector=void 0;const r=a(100);class i{constructor(e,t,a){this.constants=e,this.variableStore=t,this.clock=a,this.eventEmitter=new r.EventEmitter,this.totalActiveDaysNumber=0,this.allDayPassed=!0,this.incrementDate="1/1/1970"}static isBoosterApiAvailable(e){return"gx"===e.productType}static isLimitersApiAvailable(e){return"gx"===e.productType}static isPowerSaverApiAvailable(){return void 0!==opr.powerSavePrivate&&void 0!==opr.powerSavePrivate.onBatteryStatusChanged&&void 0!==opr.powerSavePrivate.onStatusChanged}static registerVariables(e,t){t.registerIntVariable("downloads_size",this.VARIABLES.downloads_size.default),t.registerIntVariable("total_tab_count",this.VARIABLES.total_tab_count.default),t.registerIntVariable("current_window_tab_count",this.VARIABLES.current_window_tab_count.default),i.isBoosterApiAvailable(e)&&t.registerIntVariable("browser_files_size",this.VARIABLES.browser_files_size.default),i.isLimitersApiAvailable(e)&&t.registerIntVariable("ram_usage",this.VARIABLES.ram_usage.default),i.isPowerSaverApiAvailable()&&(t.registerStringVariable("battery_status",this.VARIABLES.battery_status.default),t.registerIntVariable("battery_level_percent",this.VARIABLES.battery_level_percent.default),t.registerIntVariable("battery_saver_enabled",this.VARIABLES.battery_saver_enabled.default),t.registerIntVariable("battery_saver_is_saving_now",this.VARIABLES.battery_saver_is_saving_now.default),t.registerIntVariable("battery_saver_auto_on_enabled",this.VARIABLES.battery_saver_auto_on_enabled.default),t.registerIntVariable("active_days_count",this.VARIABLES.active_days_count.default))}async init(){chrome.tabs.onCreated.addListener((()=>{this.collectTabStats(),this.collectCurrentWindowTabStats(),this.collectActiveDaysStats()})),chrome.tabs.onRemoved.addListener((()=>{this.collectTabStats(),this.collectCurrentWindowTabStats(),this.collectActiveDaysStats()}));const e=()=>this.collectActiveDaysStats();this.allDayPassed||(chrome.tabs.onCreated.removeListener(e),chrome.tabs.onRemoved.removeListener(e)),chrome.windows.onFocusChanged.addListener((()=>this.collectCurrentWindowTabStats())),chrome.downloads.onChanged.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onErased.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onCreated.addListener((()=>this.collectDownloadsStats())),this.clock.setOnBeforeMinutePassedBarrier((()=>this.collectPerformanceStats())),chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.find((e=>"power_save_mode.feature_enabled"===e.key||"power_save_mode.automatic_enabled"===e.key))&&this.collectPrefs()})),i.isPowerSaverApiAvailable()&&(opr.powerSavePrivate.onStatusChanged.addListener((e=>this.setBatterySaverIsSavingVariable(e.isEnabled))),opr.powerSavePrivate.onBatteryStatusChanged.addListener((e=>this.setBatteryStatusVariables(e)))),await this.collectTabStats(),await this.collectCurrentWindowTabStats(),await this.collectDownloadsStats(),await this.collectPerformanceStats(),await this.collectBatteryStats(),await this.collectActiveDaysStats()}get totalTabNumber(){return this.totalTabNumber_}get currentWindowTabNumber(){return this.currentWindowTabNumber_}addTotalTabNumberChangedListener(e){this.eventEmitter.on("total-tab-number-changed",e)}removeTotalTabNumberChangedListener(e){this.eventEmitter.removeListener("total-tab-number-changed",e)}addCurrentWindowTabNumberChangedListener(e){this.eventEmitter.on("current-window-tab-number-changed",e)}removeCurrentWindowTabNumberChangedListener(e){this.eventEmitter.removeListener("current-window-tab-number-changed",e)}async collectTabStats(){const e=await new Promise((e=>chrome.windows.getAll({populate:!0},e)));this.totalTabNumber_=e.filter((e=>"normal"===e.type)).map((e=>e.tabs.length)).reduce(((e,t)=>t+e),0),this.variableStore.setInt("total_tab_count",this.totalTabNumber_),this.eventEmitter.emit("total-tab-number-changed",this.totalTabNumber_)}async collectCurrentWindowTabStats(){this.currentWindowTabNumber_=(await new Promise((e=>chrome.tabs.query({currentWindow:!0,pinned:!1},e)))).length,this.variableStore.setInt("current_window_tab_count",this.currentWindowTabNumber_),this.eventEmitter.emit("current-window-tab-number-changed",this.currentWindowTabNumber_)}async collectActiveDaysStats(){this.allDayPassed&&(this.totalActiveDaysNumber=Number(localStorage.getItem("currentActiveDaysNumber")),isNaN(this.totalActiveDaysNumber)&&(this.totalActiveDaysNumber=0),this.incrementDate=localStorage.getItem("incrementDate"),this.incrementDate!==(new Date).toLocaleDateString()&&(this.totalActiveDaysNumber=++this.totalActiveDaysNumber,this.incrementDate=(new Date).toLocaleDateString(),localStorage.setItem("incrementDate",this.incrementDate)),this.allDayPassed=!1,setTimeout((()=>{this.allDayPassed=!0}),function(){const e=new Date;return new Date(e).setHours(24,0,0,0)-e}()),this.variableStore.setInt("active_days_count",this.totalActiveDaysNumber),localStorage.setItem("currentActiveDaysNumber",String(this.totalActiveDaysNumber)))}async getDownloadsDiskSpace(){return new Promise((e=>{chrome.downloads.search({exists:!0},(t=>{e(t.reduce(((e,t)=>e+(t.exists?t.bytesReceived:0)),0))}))}))}async collectDownloadsStats(){var e;this.variableStore.setInt("downloads_size",(e=await this.getDownloadsDiskSpace(),Math.floor(e/1048576)))}async collectPerformanceStats(){if(i.isBoosterApiAvailable(this.constants)){const e=await new Promise((e=>chrome.boosterPrivate.getTotalUsedDiskSpace(e)));this.variableStore.setInt("browser_files_size",e)}if(i.isLimitersApiAvailable(this.constants)){const e=await new Promise((e=>opr.limitersPrivate.getCurrentMemoryUsage(e)));this.variableStore.setInt("ram_usage",e.memoryUsed)}}async collectPrefs(){const e=await new Promise((e=>chrome.settingsPrivate.getPref("power_save_mode.automatic_enabled",e)));this.variableStore.setInt("battery_saver_auto_on_enabled",e.value?1:0);const t=await new Promise((e=>chrome.settingsPrivate.getPref("power_save_mode.feature_enabled",e)));this.variableStore.setInt("battery_saver_enabled",t.value?1:0)}async setBatteryStatusVariables(e){this.variableStore.setString("battery_status",e.dischargingState),this.variableStore.setInt("battery_level_percent",Math.round(100*e.level))}async setBatterySaverIsSavingVariable(e){this.variableStore.setInt("battery_saver_is_saving_now",e?1:0)}async collectBatteryStats(){if(!i.isPowerSaverApiAvailable())return;const e=await new Promise((e=>opr.powerSavePrivate.getStatus(e)));await this.setBatterySaverIsSavingVariable(e.isEnabled);const t=await new Promise((e=>opr.powerSavePrivate.getBatteryStatus(e)));await this.setBatteryStatusVariables(t),await this.collectPrefs()}}t.PerformanceVariableCollector=i,i.VARIABLES={total_tab_count:{default:0,description:"Total tabs in all windows"},current_window_tab_count:{default:0,description:"Number of tabs in current window"},ram_usage:{default:0,description:"RAM usage (polled every minute)"},browser_files_size:{default:0,description:"Browser file size (polled every minute)"},downloads_size:{default:0,description:"Downloads size (polled every minute)"},battery_status:{default:"UNKNOWN",description:"Battery status: CHARGING, DISCHARGING, UNKNOWN"},battery_level_percent:{default:100,description:"Battery level 0-100"},battery_saver_enabled:{default:0,description:"Whether the battery saver feature is enabled"},battery_saver_is_saving_now:{default:0,description:"Whether the battery saver is saving power"},battery_saver_auto_on_enabled:{default:0,description:"Whether the battery saver turns on automatically"},active_days_count:{default:0,description:"Number of active user days"}}},744:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TabChangedEventSource=void 0;class a{constructor(e,t,a,r){this.fireEvent=e,this.onTabActivated=t,this.tabsGetFunction=a,this.variableStore=r}static registerVariables(e){e.registerStringVariable("last_navigation",this.VARIABLES.last_navigation.default)}async listener(e){const t=await new Promise((t=>this.tabsGetFunction(e.tabId,t)));await this.variableStore.setString("last_navigation",t.url),this.fireEvent({eventName:a.EVENT_SOURCE_NAME,windowId:e.windowId})}async activate(){this.listenerObject=this.listener.bind(this),this.onTabActivated.addListener(this.listenerObject)}async deactivate(){this.onTabActivated.removeListener(this.listenerObject),this.listenerObject=null}}t.TabChangedEventSource=a,a.VARIABLES={last_navigation:{default:"none",description:"Last navigated url"}},a.EVENT_SOURCE_NAME="tab-changed"},295:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryPatches=void 0;class a{constructor(){opr.browserSidebarPrivate&&opr.browserSidebarPrivate.onItemExpanded&&opr.browserSidebarPrivate.onItemExpanded.addListener(this.onItemExpanded)}onItemExpanded(e){e===a.LASTCARD_ID&&chrome.runtime.sendMessage(a.LASTCARD_ID,{type:"ToggleRedDot",data:!1})}}a.LASTCARD_ID="niedpkpgcoojodjamdaecieijchonfnm",t.TemporaryPatches=class{constructor(){this.lastpass=new a}}},922:(e,t)=>{function a(){return Math.floor((+new Date-+new Date("1601-01-01 00:00:00 UTC"))/36e5)}Object.defineProperty(t,"__esModule",{value:!0}),t.UiVariableCollector=void 0;class r{constructor(e){this.variableStore=e,this.windowObservers=new Map}static isAvailable(){return void 0!==opr.uiTrackerPrivate}static registerVariables(e){e.registerIntVariable("vpn_badge_interaction_timestamp",this.VARIABLES.vpn_badge_interaction_timestamp.default),e.registerIntVariable("vpn_enabled",this.VARIABLES.vpn_enabled.default),e.registerIntVariable("vpn_enabled_timestamp",this.VARIABLES.vpn_enabled_timestamp.default)}observeWindow(e){if(this.windowObservers.has(e.id))throw new Error("Window already observed");const t={vpnMouseObserver:(e,t)=>this.onVpnMouseAction(e,t),vpnStateObserver:(e,t)=>this.onVpnUiStateChanged(e,t)};this.windowObservers.set(e.id,t),opr.uiTrackerPrivate.onUiElementPropertyChanged.addListener(t.vpnStateObserver,e.id,"address_bar_vpn","UiState"),opr.uiTrackerPrivate.onUiElementAction.addListener(t.vpnMouseObserver,e.id,"address_bar_vpn","Mouse")}onWindowRemoved(e){this.windowObservers.delete(e)}onVpnMouseAction(e,t){t.error||"ET_MOUSE_RELEASED"===/[^\s]+/.exec(t.actionDetails)[0]&&this.variableStore.setInt("vpn_badge_interaction_timestamp",a())}onVpnUiStateChanged(e,t){if(t.error)return;const r=this.currentEnabledState;if(this.currentEnabledState="inactive"!==t.propertyValue&&"invisible"!==t.propertyValue,r!=this.currentEnabledState){const e=void 0===r,t=0===this.variableStore.getInt("vpn_enabled_timestamp");!this.currentEnabledState||e&&!t||this.variableStore.setInt("vpn_enabled_timestamp",a(),"dont_flush"),this.variableStore.setInt("vpn_enabled",this.currentEnabledState?1:0)}}async init(){const e=await new Promise((e=>chrome.windows.getAll({windowTypes:["normal"]},e)));chrome.windows.onCreated.addListener((e=>{"normal"===e.type&&this.observeWindow(e)})),chrome.windows.onRemoved.addListener((e=>this.onWindowRemoved(e))),e.forEach((e=>this.observeWindow(e)))}}t.UiVariableCollector=r,r.VARIABLES={vpn_badge_interaction_timestamp:{default:0,description:"Last interaction time with the VPN badge as a Webkit timestamp"},vpn_enabled:{default:0,description:"Current state of the VPN badge"},vpn_enabled_timestamp:{default:0,description:"Time when VPN was enabled as a Webkit timestamp"}}},955:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableRegistry=void 0,t.VariableRegistry=class{constructor(){this._variables=new Map}get variables(){return this._variables}registerIntVariable(e,t){this.variables.set(e,t)}registerStringVariable(e,t){this.variables.set(e,t)}}},3:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableStore=void 0;class a{constructor(e,t){this.storage=e,this.settings=t}static async saveInternal(e,t){await new Promise((a=>e.set(t,a)))}async setInt(e,t,a){if(!(e in this.settings.trigger_variables.int))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.int[e]=t,void 0!==a&&"flush"!==a||await this.save()}async setString(e,t,a){if(!(e in this.settings.trigger_variables.string))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.string[e]=t,void 0!==a&&"flush"!==a||await this.save()}getInt(e){const t=this.settings.trigger_variables.int[e];if(void 0===t)throw new Error("Variable not registered");return t}getString(e){const t=this.settings.trigger_variables.string[e];if(void 0===t)throw new Error("Variable not registered");return t}async save(){await a.saveInternal(this.storage,this.settings)}static async load(e,t){var r;const i={trigger_variables:null!==(r=(await new Promise((t=>e.get((e=>t(e)))))).trigger_variables)&&void 0!==r?r:{int:{},string:{}}};return["int","string"].forEach((e=>{const a=new Set;for(const r in i.trigger_variables[e])(()=>{const a=t.variables.get(r);return(void 0===a?"none":"string"==typeof a?"string":"int")!==e})()&&a.add(r);a.forEach((t=>{delete i.trigger_variables[e][t]}))})),t.variables.forEach(((e,t)=>{const a="string"==typeof e?"string":"int",r="string"==typeof e?"int":"string";t in i.trigger_variables[a]||(i.trigger_variables[a][t]=e),t in i.trigger_variables[r]&&delete i.trigger_variables[r][t]})),await a.saveInternal(e,i),new a(e,i)}}t.VariableStore=a},712:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VpnProEventSource=void 0;class a{constructor(e){this.variableStore=e}isSubscriptionValid(e){return Date.now()<new Date(e).getTime()}async onStateChange(e){if(e===opr.vpnProPrivate.State.SUBSCRIPTION_EXPIRED)return this.variableStore.setInt("vpnpro_subsc_expired",1),this.variableStore.setInt("vpnpro_subsc_active",0),void this.fireEvent();const t=await new Promise((e=>{opr.vpnProPrivate.getSubscriptionDetails((t=>{e(t.expiresAt)}))}));if(this.isSubscriptionValid(t)){const e=this.variableStore.getInt("vpnpro_subsc_active");this.variableStore.setInt("vpnpro_subsc_expired",0),this.variableStore.setInt("vpnpro_subsc_active",1),0===e&&this.fireEvent()}else this.variableStore.setInt("vpnpro_subsc_active",0)}async fireEvent(){await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME},e)))}static registerVariables(e){e.registerIntVariable("vpnpro_subsc_active",this.VARIABLES.vpnpro_subsc_active.default),e.registerIntVariable("vpnpro_subsc_expired",this.VARIABLES.vpnpro_subsc_expired.default)}static isAvailable(){return!!opr.vpnProPrivate}async activate(){this.listenerObject=e=>this.onStateChange(e),opr.vpnProPrivate.onStateChanged.addListener(this.listenerObject)}async deactivate(){opr.vpnProPrivate.onStateChanged.removeListener(this.listenerObject),delete this.listenerObject}}t.VpnProEventSource=a,a.EVENT_SOURCE_NAME="vpn-pro",a.VARIABLES={vpnpro_subsc_expired:{default:0,description:"Subscription expired: 0 - no/never activated, 1 - expired"},vpnpro_subsc_active:{default:0,description:"Subscription status: 0 - inactive/unknown, 1 - active"}}}},t={};function a(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}(()=>{const e=a(304),t=a(267),r=a(793),i=a(114),s=a(744),n=a(497),o=a(853),c=a(756),l=a(955),d=a(3),h=a(786),u=a(553),v=a(792),m=a(103),g=a(628),b=a(314),p=a(105),_=a(561),E=a(295),w=a(862),f=a(463),y=a(922),S=a(618),A=a(257),T=a(712),C=a(923),I=a(896),L=a(674);document.errorReporter=new i.ErrorReporter,document.addEventListener("DOMContentLoaded",(async()=>{const a=new A.Constants(await A.Constants.getProductType()),i=new l.VariableRegistry;s.TabChangedEventSource.registerVariables(i),n.CategoryEventSource.registerVariables(i),b.CashbackBadgeShownEventSource.registerVariables(i),T.VpnProEventSource.registerVariables(i),I.AriaEventSource.registerVariables(i),_.ExtensionPromotions.registerVariables(i),r.Adblock.registerVariables(i);const N=await u.HistoryTagStorage.readHistoryTagsFromJson("history-tags.json");u.HistoryTagStorage.registerVariables(i,N),w.AgentClock.registerVariables(i),f.PerformanceVariableCollector.registerVariables(a,i),y.UiVariableCollector.isAvailable()&&y.UiVariableCollector.registerVariables(i),S.CheckoutPageEventSource.isAvailable()&&S.CheckoutPageEventSource.registerVariables(i);const P=await d.VariableStore.load(chrome.storage.local,i);document.extensionPromotions=new _.ExtensionPromotions(P),document.adblock=new r.Adblock(P);const O=await(0,p.checkExtensionLaunchType)(),k=new w.AgentClock(P);await k.init(O),document.performanceVariableCollector=new f.PerformanceVariableCollector(a,P,k),document.performanceVariableCollector.init(),y.UiVariableCollector.isAvailable()&&(document.uiVariableCollector=new y.UiVariableCollector(P),document.uiVariableCollector.init());const M=new Map;M.set(s.TabChangedEventSource.EVENT_SOURCE_NAME,(()=>new s.TabChangedEventSource(opr.richHintsAgentPrivate.fireEvent,chrome.tabs.onActivated,chrome.tabs.get,P))),M.set(L.DiscordPanelOpenedEventSource.EVENT_SOURCE_NAME,(()=>new L.DiscordPanelOpenedEventSource(opr.richHintsAgentPrivate.fireEvent,opr.browserSidebarPrivate.onItemExpanded))),M.set(n.CategoryEventSource.EVENT_SOURCE_NAME,(()=>new n.CategoryEventSource(opr.richHintsAgentPrivate.fireEvent,chrome.tabs.onUpdated,chrome.tabs.onRemoved,P))),M.set(o.ManyTabsEventSource.EVENT_SOURCE_NAME,(()=>new o.ManyTabsEventSource(document.performanceVariableCollector))),M.set(c.ManyTabsFlowEventSource.EVENT_SOURCE_NAME,(()=>new c.ManyTabsFlowEventSource(document.performanceVariableCollector))),T.VpnProEventSource.isAvailable()&&M.set(T.VpnProEventSource.EVENT_SOURCE_NAME,(()=>new T.VpnProEventSource(P))),M.set(I.AriaEventSource.EVENT_SOURCE_NAME,(()=>new I.AriaEventSource(P))),b.CashbackBadgeShownEventSource.isAvailable()&&M.set(b.CashbackBadgeShownEventSource.EVENT_SOURCE_NAME,(()=>new b.CashbackBadgeShownEventSource(P))),S.CheckoutPageEventSource.isAvailable()&&M.set(S.CheckoutPageEventSource.EVENT_SOURCE_NAME,(()=>new S.CheckoutPageEventSource(P))),M.set(w.ClockEventSource.EVENT_SOURCE_NAME,(()=>new w.ClockEventSource(k))),M.set(C.AIToolsEventSource.EVENT_SOURCE_NAME,(()=>new C.AIToolsEventSource(opr.richHintsAgentPrivate.fireEvent)));const V=await u.HistoryTagStorage.load("history_tags",P),R=new h.HistoryTagUpdater(V,N,18e5),D=Date.now();for(const e of N){const t=await g.HistoryTagEventsBackend.make(g.HistoryTagEventsBackend.getDefaultStorageKey(e.tag),D,O,e.tag,R,V);M.set(v.BrowserLaunchedWithTagAssigned.eventNameForTag(e.tag),(()=>new v.BrowserLaunchedWithTagAssigned(t))),M.set(m.HistoryTagAssignedEventSource.eventNameForTag(e.tag),(()=>new m.HistoryTagAssignedEventSource(t)))}const B=new t.EventSourceFactoryImpl(M);document.eventRegistry=new e.EventRegistry(opr.richHintsAgentPrivate.onSpecificationUpdated,opr.richHintsAgentPrivate.provideEvents,B),document.patches=new E.TemporaryPatches,R.init(document.eventRegistry),document.eventRegistry.registerEvents()}),!1)})()})();